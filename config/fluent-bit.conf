[SERVICE]
    Flush        1
    Log_Level    info
    Parsers_File parsers.conf

[INPUT]
    Name              forward
    Listen            0.0.0.0
    Port              24224

[FILTER]
    Name parser
    Match *
    Key_Name log
    Parser json
    Reserve_Data On
    Preserve_Key Off

# Renames 'log' (default Docker field) to 'message' (expected by VictoriaLogs output)
# This handles cases where JSON parsing failed or wasn't applicable.
[FILTER]
    Name modify
    Match *
    Rename log message

[FILTER]
    Name lua
    Match *
    script /fluent-bit/etc/append_container_name.lua
    call append_container_name

[OUTPUT]
    Name http
    Match *
    Host victorialogs
    Port 9428
    URI /insert/jsonline?_stream_fields=container_name&_msg_field=message
    Format json_lines
    Json_date_format iso8601
