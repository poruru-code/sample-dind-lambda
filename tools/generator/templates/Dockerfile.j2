# Auto-generated by SAM Template Generator
# DO NOT EDIT MANUALLY - Regenerate with: python -m tools.generator.main
# Source: template.yaml
# FunctionName: {{ name }}

{% if zip_layers %}
FROM alpine:latest as layer-unzipper
RUN apk add --no-cache unzip
    {% for layer in zip_layers %}
COPY {{ layer.content_uri }} /tmp/{{ layer.name }}.zip
RUN unzip /tmp/{{ layer.name }}.zip -d /opt/ || [ $? -eq 1 ]
    {% endfor %}
{% endif %}

FROM esb-lambda-base:latest

# ---------------------------------------------------
# ESB Runtime (Monkey Patch)
# ---------------------------------------------------
COPY sitecustomize.py /opt/python/sitecustomize.py

{% if zip_layers %}
COPY --from=layer-unzipper /opt/ /opt/
{% endif %}

{% for layer in other_layers %}
# ---------------------------------------------------
# Layer: {{ layer.name }} (Directory)
# ---------------------------------------------------
COPY {{ layer.content_uri }} /opt/
{% endfor %}

{% if has_requirements %}
# ---------------------------------------------------
# 関数固有の依存パッケージ
# ---------------------------------------------------
COPY {{ code_uri }}requirements.txt ${LAMBDA_TASK_ROOT}/
RUN pip install -r ${LAMBDA_TASK_ROOT}/requirements.txt

{% endif %}
# ---------------------------------------------------
# 関数コードの配置
# ---------------------------------------------------
COPY {{ code_uri }} ${LAMBDA_TASK_ROOT}/

# ---------------------------------------------------
# ハンドラ指定
# ---------------------------------------------------
CMD [ "{{ handler }}" ]
