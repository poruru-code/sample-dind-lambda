# 【A】ホストOSで実行するComposeファイル（DinD親コンテナを起動）
# 本番環境ではこのファイルを使用してDinD環境全体を起動する

services:
  # ============================================
  # Root DinD Container
  # ============================================
  esb-app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: esb-root
    privileged: true  # DinDに必須
    ports:
      - "443:443"     # Gateway API (HTTPS)
      - "9000:9000"   # RustFS API
      - "9001:9001"   # RustFS Console
      - "9428:9428"   # VictoriaLogs
      - "8001:8001"   # ScyllaDB Alternator
    volumes:
      # データ永続化（ホストOS -> 親コンテナ -> 子コンテナ）
      - ./data:/app/data
      # ログ集約
      - ./logs:/logs
    restart: unless-stopped
